version: 2.1

jobs:
  build:
    docker:
      - image: circleci/python:3.8

    steps:
      - checkout

      # Display SSH Fingerprint
      - run:
          name: Display SSH Fingerprint
          command: |
            echo "Checking SSH key fingerprint..."
           sudo mkdir -p /home/ec2-user/.ssh
            ssh-keygen -lf /home/ec2-user/.ssh

      # Enable SSH agent and add SSH key
      - add_ssh_keys:
          fingerprints:
            - "39:55:42:95:99:2e:df:f4:e7:fb:f3:a4:2c:b6:53:91"

      # SSH into Server and Git Pull
      - run:
          name: SSH into Server and Git Pull
          command: |
            ssh -i /home/ec2-user/.ssh ec2-user@34.253.191.231 "cd /home/ec2-user/circlci.sh && git pull"
